<div class="app-content content ">
  <div class="content-overlay"></div>
  <div class="header-navbar-shadow"></div>
  <div class="content-wrapper container-xxl p-0">
    <div class="content-header row">
    </div>
    <div class="content-body">
      <!-- Dashboard Ecommerce Starts -->
      <section id="dashboard-ecommerce">
        <div class="row match-height">
          <!-- Medal Card -->

          <!--/ Medal Card -->

          <!-- Statistics Card -->
          <div class="col-xl-12 col-md-6 col-12">
            <div class="card card-statistics">
              <div class="card-header">
                <h4 class="card-title">Statistics</h4>
                <!-- <div class="d-flex align-items-center">
                                        <p class="card-text font-small-2 me-25 mb-0">Updated 1 month ago</p>
                                    </div> -->
              </div>
              <div class="card-body statistics-body">
                <div class="row">
                  <div class="col-xl-3 col-sm-6 col-12 mb-2 mb-xl-0">
                    <div class="d-flex flex-row">
                      <div class="avatar bg-light-primary me-2">
                        <div class="avatar-content">
                          <i data-feather="trending-up" class="avatar-icon"></i>
                        </div>
                      </div>
                      <div class="my-auto">
                        <h4 class="fw-bolder mb-0" id="totalUsers">0</h4>
                        <p class="card-text font-small-3 mb-0">Total User</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 mb-2 mb-xl-0">
                    <div class="d-flex flex-row">
                      <div class="avatar bg-light-info me-2">
                        <div class="avatar-content">
                          <i data-feather="user" class="avatar-icon"></i>
                        </div>
                      </div>
                      <div class="my-auto">
                        <h4 class="fw-bolder mb-0" id="totalDrivers">0</h4>
                        <p class="card-text font-small-3 mb-0">Total Driver</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12 mb-2 mb-sm-0">
                    <div class="d-flex flex-row">
                      <div class="avatar bg-light-danger me-2">
                        <div class="avatar-content">
                          <i data-feather="box" class="avatar-icon"></i>
                        </div>
                      </div>
                      <div class="my-auto">
                        <h4 class="fw-bolder mb-0" id="todayUsers">0</h4>
                        <p class="card-text font-small-3 mb-0">Today User</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-xl-3 col-sm-6 col-12">
                    <div class="d-flex flex-row">
                      <div class="avatar bg-light-success me-2">
                        <div class="avatar-content">
                          <i data-feather="dollar-sign" class="avatar-icon"></i>
                        </div>
                      </div>
                      <div class="my-auto">
                        <h4 class="fw-bolder mb-0" id="todayDrivers">0</h4>
                        <p class="card-text font-small-3 mb-0">Today Driver</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>


          <div class="col-xl-12 col-md-6 col-12">
            <div class="card">
              <div class="card-header">
                <h2>latest Users</h2>
              </div>
              <div class="card-body">
                <div class="table-responsive card card-company-table">
                  <script>
                    $(document).ready(function() {
                      var table = $('#categoriesTable').DataTable({
                        paging: false, // ❌ disable pagination
                        searching: false, // ❌ disable search box
                        info: false, // ❌ disable "showing x of y"
                        // processing: true,
                        // serverSide: true,
                        ajax: {
                          url: '/admin/users/homeData',
                          type: 'POST',
                          contentType: 'application/json',
                          data: function(d) {
                            // Get values from both filters
                            var search = $('#searchFilter').val(); // Get search term
                            var status = $('#statusFilter').val(); // Get selected status

                            // Add search term and status filter to the data object
                            if (search) {
                              d.search = search; // Add the search term
                            }
                            if (status) {
                              d.status = status; // Add the status filter if it's selected
                            }

                            return JSON.stringify(d); // Return the modified data object

                            feather.replace();

                          }
                        },
                        columns: [{
                            data: null,
                            render: function(data, type, row, meta) {
                              return meta.settings._iDisplayStart + meta.row + 1;
                            },
                            searchable: false,
                            orderable: false
                          },
                          {
                            data: 'name'
                          },

                          {
                            data: 'gender'
                          },
                          {
                            data: 'dob'
                          },
                          
                        ],
                        drawCallback: function(settings) {
                          feather.replace(); // Ensures icons are replaced every time table is drawn
                        }
                      });

                      // Reload table when either filter or search is changed
                      $('#statusFilter, #searchFilter').on('change keyup', function() {
                        table.ajax.reload(); // Reload DataTable on change or keyup
                      });
                    });
                  </script>

                  <table class="table" id="categoriesTable">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Gender</th>
                        <th>DOB</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </div>
          <!--/ Statistics Card -->
        </div>




      </section>
      <!-- Dashboard Ecommerce ends -->

    </div>
  </div>
</div>

<script>
  async function loadStats() {
    try {
      const res = await fetch('/admin/stats');
      const data = await res.json();

      document.getElementById('totalUsers').innerText = data.totalUsers;
      document.getElementById('totalDrivers').innerText = data.totalDrivers;
      document.getElementById('todayUsers').innerText = data.todayUsers;
      document.getElementById('todayDrivers').innerText = data.todayDrivers;
    } catch (err) {
      console.error('Error loading stats:', err);
    }
  }

  // Call when page loads
  loadStats();
</script>